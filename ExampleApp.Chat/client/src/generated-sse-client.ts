import { BASE_URL } from './utils/BASE_URL';

/**
 * Auto-generated EventSource client
 * Generated by StateleSSE.CodeGen
 * DO NOT EDIT MANUALLY
 */

/**
 * Subscribe to Message events
 * @param groupid - groupId (optional)
 * @returns EventSource instance for Message
 */
export function subscribeMessage(groupid?: string): EventSource {
    const queryParams = new URLSearchParams({ ...(groupid !== undefined ? { groupid } : {}) });
    const url = `${BASE_URL}/StreamMessages?${queryParams}`;
    return new EventSource(url);
}

/**
 * Generic EventSource helper with typed callbacks
 */
export function createTypedEventStream<T>(
    url: string,
    onMessage: (event: T) => void,
    onError?: (error: Event) => void
): EventSource {
    const es = new EventSource(url);

    es.onmessage = (e) => {
        try {
            const data: T = JSON.parse(e.data);
            onMessage(data);
        } catch (error) {
            console.error('Failed to parse SSE event:', error);
        }
    };

    if (onError) {
        es.onerror = onError;
    }

    return es;
}
