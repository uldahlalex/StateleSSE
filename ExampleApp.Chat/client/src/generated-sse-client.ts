import { BASE_URL } from './utils/BASE_URL';

/**
 * Auto-generated EventSource client
 * Generated by StateleSSE.CodeGen
 * DO NOT EDIT MANUALLY
 */

/**
 * Subscribe to Message events
 * @param onMessage - Callback for typed message events
 * @param options - Optional configuration object
 * @param options.groupid - groupId (optional)
 * @param options.onError - Optional error callback
 * @returns EventSource instance for Message
 */
export function subscribeMessage<T = any>(onMessage: (event: T) => void, options?: { groupid?: string; onError?: (error: Event) => void }): EventSource {
    const queryParams = new URLSearchParams({ ...(options?.groupid !== undefined ? { groupid: options.groupid } : {}) });
    const url = `${BASE_URL}/StreamMessages?${queryParams}`;
    
    const es = new EventSource(url);
    es.onmessage = (e) => {
        try {
            const data: T = JSON.parse(e.data);
            onMessage(data);
        } catch (error) {
            console.error('Failed to parse SSE event:', error);
        }
    };
    
    if (options?.onError) {
        es.onerror = options.onError;
    }
    
    return es;
}

