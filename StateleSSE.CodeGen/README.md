# StateleSSE.CodeGen

**Zero-dependency TypeScript EventSource client generator from OpenAPI specifications.**

## Features

- ✅ **Zero dependencies** - only uses built-in `System.Text.Json`
- ✅ **Framework-agnostic** - works with any OpenAPI spec (Swashbuckle, NSwag, Microsoft.AspNetCore.OpenApi, or even non-.NET sources)
- ✅ **Simple** - reads `openapi.json`, finds `text/event-stream` endpoints, generates TypeScript
- ✅ **Type-safe** - generates typed query parameters from OpenAPI schema
- ✅ **Multi-target** - supports .NET 6, 8, 9, and 10
- ✅ **Zero configuration** - uses standard HTTP content-type detection

## Usage

### As a Library

```csharp
using StateleSSE.CodeGen;

TypeScriptEventSourceGenerator.Generate(
    openApiSpecPath: "path/to/openapi.json",
    outputPath: "client/src/generated-sse-client.ts",
    baseUrlImport: "./utils/BASE_URL"  // optional, defaults to this
);
```

### Example Generated Output

Given an OpenAPI spec with:
```json
{
  "paths": {
    "/StreamMessages": {
      "get": {
        "operationId": "Messages_StreamMessages",
        "summary": "Stream chat messages",
        "responses": {
          "200": {
            "content": {
              "text/event-stream": {
                "schema": { "$ref": "#/components/schemas/Message" }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "groupid",
            "in": "query",
            "required": true,
            "schema": { "type": "string" }
          }
        ]
      }
    }
  }
}
```

Generates:
```typescript
import { BASE_URL } from './utils/BASE_URL';

/**
 * Auto-generated EventSource client
 * Generated by StateleSSE.CodeGen
 * DO NOT EDIT MANUALLY
 */

/**
 * Stream chat messages
 * @param groupid - groupid
 * @returns EventSource instance for Message
 */
export function streamMessages(groupid: string): EventSource {
    const queryParams = new URLSearchParams({ groupid });
    const url = `${BASE_URL}/StreamMessages?${queryParams}`;
    return new EventSource(url);
}

/**
 * Generic EventSource helper with typed callbacks
 */
export function createTypedEventStream<T>(
    url: string,
    onMessage: (event: T) => void,
    onError?: (error: Event) => void
): EventSource {
    const es = new EventSource(url);

    es.onmessage = (e) => {
        try {
            const data: T = JSON.parse(e.data);
            onMessage(data);
        } catch (error) {
            console.error('Failed to parse SSE event:', error);
        }
    };

    if (onError) {
        es.onerror = onError;
    }

    return es;
}
```

## How It Works

1. Reads your OpenAPI JSON spec
2. Finds GET endpoints that return `text/event-stream` content type
3. Extracts:
   - Path
   - Event type from schema `$ref` (e.g., `#/components/schemas/Message`)
   - Operation ID for function naming
   - Query parameters with types
4. Generates TypeScript functions with type-safe parameters

## Requirements

The generator looks for endpoints with `text/event-stream` content type in responses.

Mark your ASP.NET Core controllers with standard attributes:
```csharp
[HttpGet("StreamMessages")]
[Produces("text/event-stream")]
[ProducesResponseType(typeof(Message), 200)]
public async Task StreamMessages(string groupId)
{
    await StreamEventType<Message>($"chat:{groupId}:Message");
}
```

**Works automatically** with all OpenAPI frameworks (Swashbuckle, NSwag, Microsoft.AspNetCore.OpenApi) - no custom configuration needed.

## Dependencies

**None.** Only uses:
- `System.Text`
- `System.Text.Json` (built into .NET)

No NuGet packages required.
